#### 7.4
写写开发日记。

首先遇到的第一个抉择点，是关于`steamAPI`的封装。说实话，我并不清楚封装到什么程度才算好的封装，原本打算像`axios`封装那样，封装成`url`,`params`。但是我想了想，这个网页其实只是用于展示一下我的游戏库，我并没有打算添加别的功能，或者别的与其他人交互的功能，毕竟我没有服务器，通过静态网页来调用接口还是不太安全（我可不想我的steam号被封了）。所以最终决定，封装到只有关于账号的参数，毕竟我打算把项目放到`github`上，别人用起来也方便点。

然后是关于`steamAPI`文件，里面有一些功能是我自己写的时候发现手动打比较重复且存在出错可能，叫AI帮我生成的。有一部分内容比较难以理解，以后我会补充相关知识点。

前几天我遇到了项目的第一个难题，当时我正在写`APIdemo`，打算尝试一下能不能跑通接口。为了规范性，我将测试用的`.js`文件改为了`.ts`文件。然后就出现问题了，无法运行ts文件，报错`Error [ERR_MODULE_NOT_FOUND]: Cannot find module`
这是因为脚本文件找不到模块，当时我检查了五六次，文件名是对的，后缀是`.ts`文件。值得注意的是，当时IDE有报错`只有在设置“noEmit”或“emitDeclarationOnly”时，才能使用选项“allowImportingTsExtensions”。`。很自然地，我也尝试将ts后缀删去后运行，仍然是找不到模版。

我向AI求助，它帮我新建了`config.ts`和`package.json`，并修改了里面的一些参数，它的目的是使文件可以导入`.ts`文件。
然而没有什么用，仍然是找不到模版。也尝试了将`.ts`编译为`.js`后再运行，还是相同的报错。
再三对话后，在我的要求下，`Gemini 2.5`给出了分析问题与调试错误的方法（而不是直接给出方案）。
通过调试，在单文件时，`.ts`文件是可以正常运行的，而一旦涉及多文件的`export`/`import`时，就会失灵，无论另一个文件有多么简单。这时我就知道问题并不在于文件本身，而是`export`/`import`，不过此时我并不知道根本原因是环境。

鉴于已经进行了多轮对话，AI的回答很可能出现幻觉，我就叫他把我们之间的对话以及遇到的问题，总结为一段`Prompt`，然后开了一个新的项目和AI，让他通过`Prompt`生成文件来针对遇到的问题进行调试。
不出意外地，问题成功复现了，AI还是那个样，生成`config.ts`和`package.json`后，让我使用`node loader ts-node/esm main.ts`，其实之前已经到过这一步了，仍然无法运行，AI再无推进。
我发现AI已经到极限后，上网查找了相关的问题，也没有找到正确答案，有一个关于ts脚本踩坑的，里面也有相同的报错，不过根本不是同一个问题。

此时，我又想起了IDE的报错`只有在设置“noEmit”或“emitDeclarationOnly”时，才能使用选项“allowImportingTsExtensions”。`。之前我跟AI提过这个错误的，但是他说这是IDE的滞后性的体现，别管。然后我就去网上查了`noEmit`和`emitDeclarationOnly`。
这涉及了TS的运行原理，在`noEmit`为`falsh`时，系统在运行`.ts`时，会先将其编译为`.js`文件，实际上运行的是`.js`文件。而当`noEmit`为f`true`时，则不会生成`.js`文件，他会即时编译`.ts`文件并运行。后者则是在`/disk`中生成声明文件而不生成`.js`文件。
我试着将两个都设置为`true`，运行，成功。

然后我追问了一晚上，终于搞明白了背后的原理。运行`.ts`文件有两条路，先编译成`.js`再运行和`.ts`直接运行。
第一条`noEmit = falsh`，通过`tsc`命令将`.ts`编译为`.js`，然后用`node`直接运行。值得注意的是，在这个方法中`.ts`文件中的导入文件必须以`.js`结尾，即使在编译前还没有`.js`文件。这是因为`node`根本不认识`.ts`文件，而我们在编译后得到的`.js`文件中，还是`.ts`，所以使用`node`运行会出错。
第二条`noEmit = true`，直接通过命令`node --loader ts-node/esm main.ts`。在不输出`.js`的基础上，相当于给`node`配了一个翻译官`--loader ts-node`，它会直接将关于`ts`的部分即时编译为`js`代码交给`node`，·`node`相当于还是在读`js`代码。此时导入文件必须以`.ts`结尾，这样这个翻译官才能知道这是需要他翻译的文件。

关于`ts-node`直接运行`.ts`文件，如果只是单文件还好，涉及多文件导入导出时，需要遵守`CJS`规范(`require`和`export`)，它与`ESM`(`import`和`export`)并不兼容。

我还问了怎么配环境，
1.`npm init -y`生成`package.json`（-y标志跳过所有提问，直接使用默认值）
2.`npm install`安装需要的包，像`typescript`，`ts-node`，`@type/node`等
3.创建`tsconfig.json`文件，可以自己写也可以通过命令`npx tsc --init`创建一个带注释的模版，然后修改配置
4.修改`package.json`，添加`"type":"module"`告诉`node`使用`ESM`规范，同时也可以添加一个`start`脚本

今天就写到这里了，这是最近的内容，明天要搬校区，后天要坐火车，下次再写。